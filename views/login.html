<!DOCTYPE html>
<html>

<head>
  <title>
    This is title
  </title>
</head>

<body>
  <h1>
    Welcome to simple app
  </h1>
  <div class="container">
    <div id="tabs">
      <button id="signUpTab">Sign up</button>
      <button id="signInTab">Sign in</button>
    </div>
    <div id="signUpContent" style="display: none;">
      <h3>Sign up</h3>
      <form id="signUpForm">
        <input type="email" id="emailInput" placeholder="Email" required><br><br>
        <input type="password" id="passwordInput" placeholder="Password" required><br><br>
        <input type="password" id="confirmPasswordInput" placeholder="Enter password again" required><br><br>
        <button type="submit">Sign up</button>
      </form>
      <button id="googleAuthButton">Sign up with google</button>
    </div>
    <div id="signInContent" style="display: none;">
      <h3>Sign in</h3>
      <form id="signInForm">
        <input type="email" id="emailLogin" placeholder="Email" required><br><br>
        <input type="password" id="passwordLogin" placeholder="Password" required><br><br>
        <button type="submit">Sign in</button>
      </form>
    </div>
  </div>

  <div id="popup" style="display: none;">
    <p>Please check you email</p>
    <button id="okButton">OK</button>
  </div>

  <script>
    const signUpTab = document.getElementById('signUpTab');
    const signInTab = document.getElementById('signInTab');
    const signUpContent = document.getElementById('signUpContent');
    const signInContent = document.getElementById('signInContent');
    const signUpForm = document.getElementById('signUpForm');
    const signInForm = document.getElementById('signInForm');
    const emailInput = document.getElementById('emailInput');
    const passwordInput = document.getElementById('passwordInput');
    const confirmPasswordInput = document.getElementById('confirmPasswordInput');
    const emailLogin = document.getElementById('emailLogin');
    const passwordLogin = document.getElementById('passwordLogin');
    const popup = document.getElementById('popup');
    const okButton = document.getElementById('okButton');

    signUpTab.addEventListener('click', () => {
      signUpContent.style.display = 'block';
      signInContent.style.display = 'none';
      signUpTab.style.display = 'none';
      signInTab.style.display = 'none';
    });

    signInTab.addEventListener('click', () => {
      signUpContent.style.display = 'none';
      signInContent.style.display = 'block';
      signUpTab.style.display = 'none';
      signInTab.style.display = 'none';
    });

    const googleAuthButton = document.getElementById('googleAuthButton');
    googleAuthButton.addEventListener('click', () => {
      window.location.href = '/auth/google';
    });

    signUpForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;

      const emailValid = emailRegex.test(emailInput.value);
      const passwordValid = passwordRegex.test(passwordInput.value);
      const confirmPasswordValid = passwordInput.value === confirmPasswordInput.value;

      if (!emailValid) {
        alert('Please enter a valid email address.');
        return;
      }

      if (!passwordValid) {
        alert('Password must meet the requirements.');
        return;
      }

      if (!confirmPasswordValid) {
        alert('Passwords do not match.');
        return;
      }

      try {
        const response = await fetch('/auth/register', {
          method: 'POST',
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            email: emailInput.value,
            password: passwordInput.value,
          }),
        });
        const responseJson = await response.json()
        console.log(response)
        console.log(responseJson)
        if (response.ok) {
          popup.style.display = 'block';
        } else {
          alert(responseJson.message);
        }
      } catch (error) {
        console.error('An error occurred:', error);
      }
    });

    okButton.addEventListener('click', () => {
      window.location.replace('/');
    });

    signInForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      if (!emailLogin.value) {
        alert('Please enter a valid email address.');
        return;
      }

      if (!passwordLogin.value) {
        alert('Password must meet the requirements.');
        return;
      }

      try {
        const response = await fetch('/auth/login', {
          method: 'POST',
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            email: emailLogin.value,
            password: passwordLogin.value,
          }),
        });
        const responseJson = await response.json()
        if (!response.ok) {
          alert(responseJson.message);
        } else {
          window.location.replace('/');
        }
      } catch (error) {
        console.error('An error occurred:', error);
      }
    });
  </script>
</body>

</html>