<!doctype html>
<html style="font-size: 16px" lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="utf-8" />
    <meta name="keywords" content="37, 8k, 85" />
    <meta name="description" content="" />
    <title>dashboard</title>
    <link rel="stylesheet" href="nicepage.css" media="screen" />
    <link rel="stylesheet" href="dashboard.css" media="screen" />
    <script
      class="u-script"
      type="text/javascript"
      src="jquery-1.9.1.min.js"
      defer=""
    ></script>
    <script
      class="u-script"
      type="text/javascript"
      src="nicepage.js"
      defer=""
    ></script>
    <meta name="generator" content="Nicepage 5.19.2, nicepage.com" />
    <meta name="referrer" content="origin" />
    <link
      id="u-theme-google-font"
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,500,500i,600,600i,700,700i,800,800i"
    />
    <meta name="theme-color" content="#478ac9" />
    <meta property="og:title" content="dashboard" />
    <meta property="og:type" content="website" />
    <link rel="canonical" href="/" />
    <meta data-intl-tel-input-cdn-path="intlTelInput/" />
    <link rel="shortcut icon" href="#">
    <style>
      .toast {
        position: absolute;
        top: 25px;
        right: 30px;
        border-radius: 12px;
        background: #fff;
        padding: 20px 35px 20px 25px;
        box-shadow: 0 6px 20px -5px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        transform: translateX(calc(100% + 30px));
        transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.35);
      }

      .toast.active {
        transform: translateX(0%);
      }

      .toast .toast-content {
        display: flex;
        align-items: center;
      }

      .toast-content .message {
        display: flex;
        flex-direction: column;
        margin: 0 20px;
      }

      .message .text {
        font-size: 16px;
        font-weight: 400;
        color: #666666;
      }

      .message .text.text-1 {
        font-weight: 600;
        color: #333;
      }

      .toast .close {
        position: absolute;
        top: 10px;
        right: 15px;
        padding: 5px;
        cursor: pointer;
        opacity: 0.7;
      }

      .toast .close:hover {
        opacity: 1;
      }

      .toast .progress {
        position: absolute;
        bottom: 0;
        left: 0;
        height: 3px;
        width: 100%;
      }

      .toast .progress:before {
        content: '';
        position: absolute;
        bottom: 0;
        right: 0;
        height: 100%;
        width: 100%;
      }

      .toast .error-progress:before {
        background-color: #f44040;
      }

      .toast .success-progress:before {
        background-color: #4070f4;
      }

      .progress.active:before {
        animation: progress 3s linear forwards;
      }

      @keyframes progress {
        100% {
          right: 100%;
        }
      }

      .toast.active ~ button {
        pointer-events: none;
      }
    </style>
  </head>
  <body
    data-path-to-root="./"
    class="u-body u-overlap u-overlap-transparent u-xl-mode"
    data-lang="en"
  >
    <section
      class="u-clearfix u-image u-section-1"
      id="sec-8192"
      data-image-width="2000"
      data-image-height="1333"
    >
      <div
        class="u-container-style u-expanded-width u-grey-60 u-group u-group-1"
      >
        <div class="u-container-layout u-container-layout-1">
          <a
            href="#"
            id="logout-btn"
            class="u-border-1 u-border-grey-75 u-btn u-btn-round u-button-style u-hover-palette-1-dark-1 u-palette-1-base u-radius-50 u-btn-1"
            >Logout</a
          >
          <a
            href="/profile"
            class="u-border-1 u-border-grey-75 u-btn u-btn-round u-button-style u-hover-palette-1-dark-1 u-palette-1-base u-radius-50 u-btn-2"
            >Profile</a
          >
          <quillbot-extension
            style="
              position: absolute;
              top: 0px;
              left: 0px;
              pointer-events: none;
            "
          ></quillbot-extension>
          <quillbot-extension-highlights
            style="
              position: absolute;
              top: 0px;
              left: 0px;
              pointer-events: none;
            "
          ></quillbot-extension-highlights>
        </div>
      </div>
      <div
        class="data-layout-selected u-clearfix u-disable-padding u-gutter-36 u-layout-wrap u-layout-wrap-1"
      >
        <div class="u-gutter-0 u-layout">
          <div class="u-layout-row">
            <div
              class="u-align-center u-container-style u-layout-cell u-left-cell u-size-20 u-white u-layout-cell-1"
            >
              <div
                class="u-border-1 u-border-grey-light-1 u-container-layout u-padding-6 u-valign-middle u-container-layout-2"
              >
                <h1
                  id="total-signed-up"
                  class="u-align-center u-custom-font u-heading-font u-text u-text-palette-1-base u-text-1"
                >
                0
                </h1>
                <h6 class="u-align-center u-text u-text-2">
                  Total number of users who have signed up
                </h6>
                <quillbot-extension
                  style="
                    position: absolute;
                    top: 0px;
                    left: 0px;
                    pointer-events: none;
                  "
                ></quillbot-extension>
                <quillbot-extension-highlights
                  style="
                    position: absolute;
                    top: 0px;
                    left: 0px;
                    pointer-events: none;
                  "
                ></quillbot-extension-highlights>
              </div>
            </div>
            <div
              class="u-align-center u-container-style u-layout-cell u-size-20 u-white u-layout-cell-2"
            >
              <div
                class="u-border-1 u-border-grey-light-1 u-container-layout u-padding-6 u-container-layout-3"
              >
                <h1
                  id="total-session-today"
                  class="u-custom-font u-heading-font u-text u-text-palette-1-base u-text-3"
                >
                  0
                </h1>
                <h6 class="u-text u-text-4">
                  Total number of users with active sessions today
                </h6>
                <quillbot-extension
                  style="
                    position: absolute;
                    top: 0px;
                    left: 0px;
                    pointer-events: none;
                  "
                ></quillbot-extension>
                <quillbot-extension-highlights
                  style="
                    position: absolute;
                    top: 0px;
                    left: 0px;
                    pointer-events: none;
                  "
                ></quillbot-extension-highlights>
              </div>
            </div>
            <div
              class="u-align-center u-container-style u-layout-cell u-size-20 u-white u-layout-cell-3"
            >
              <div
                class="u-border-1 u-border-grey-light-1 u-container-layout u-padding-6 u-valign-bottom u-container-layout-4"
              >
                <h1
                  id="average-session"
                  class="u-align-center u-custom-font u-heading-font u-text u-text-palette-1-base u-text-5"
                >
                  0
                </h1>
                <h6 class="u-align-center u-text u-text-6">
                  Average number of active session users&nbsp;<br />in the last
                  7 days rolling
                </h6>
                <quillbot-extension
                  style="
                    position: absolute;
                    top: 0px;
                    left: 0px;
                    pointer-events: none;
                  "
                ></quillbot-extension>
                <quillbot-extension-highlights
                  style="
                    position: absolute;
                    top: 0px;
                    left: 0px;
                    pointer-events: none;
                  "
                ></quillbot-extension-highlights>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="custom-expanded u-table u-table-responsive u-table-1">
        <table class="u-table-entity">
          <colgroup>
            <col width="25%" />
            <col width="25%" />
            <col width="25%" />
            <col width="25%" />
          </colgroup>
          <thead class="u-palette-4-base u-table-header u-table-header-1">
            <tr style="height: 34px">
              <th class="u-border-1 u-border-palette-4-base u-table-cell"></th>
              <th class="u-border-1 u-border-palette-4-base u-table-cell">
                Timestamp of user sign up
              </th>
              <th class="u-border-1 u-border-palette-4-base u-table-cell">
                Number of times logged in
              </th>
              <th class="u-border-1 u-border-palette-4-base u-table-cell">
                Timestamp of the last user session
              </th>
            </tr>
          </thead>
          <tbody id="users-tbody" class="u-table-body">
            <tr style="height: 45px">
              <td
                class="u-border-1 u-border-grey-30 u-first-column u-grey-5 u-table-cell"
              >
                Row 1
              </td>
              <td
                class="u-border-1 u-border-grey-30 u-palette-5-light-3 u-table-cell"
              >
                Description
              </td>
              <td
                class="u-border-1 u-border-grey-30 u-palette-5-light-3 u-table-cell"
              >
                Description
              </td>
              <td
                class="u-border-1 u-border-grey-30 u-palette-5-light-3 u-table-cell"
              >
                Description
              </td>
            </tr>
            <tr style="height: 45px">
              <td
                class="u-border-1 u-border-grey-30 u-first-column u-grey-5 u-table-cell u-table-cell-9"
              >
                Row 2
              </td>
              <td
                class="u-border-1 u-border-grey-30 u-palette-5-light-3 u-table-cell"
              >
                Description
              </td>
              <td
                class="u-border-1 u-border-grey-30 u-palette-5-light-3 u-table-cell"
              >
                Description
              </td>
              <td
                class="u-border-1 u-border-grey-30 u-palette-5-light-3 u-table-cell"
              >
                Description
              </td>
            </tr>
            <tr style="height: 45px">
              <td
                class="u-border-1 u-border-grey-30 u-first-column u-grey-5 u-table-cell u-table-cell-13"
              >
                Row 3
              </td>
              <td
                class="u-border-1 u-border-grey-30 u-palette-5-light-3 u-table-cell"
              >
                Description
              </td>
              <td
                class="u-border-1 u-border-grey-30 u-palette-5-light-3 u-table-cell"
              >
                Description
              </td>
              <td
                class="u-border-1 u-border-grey-30 u-palette-5-light-3 u-table-cell"
              >
                Description
              </td>
            </tr>
            <tr style="height: 45px">
              <td
                class="u-border-1 u-border-grey-30 u-first-column u-grey-5 u-table-cell u-table-cell-17"
              >
                Row 4
              </td>
              <td
                class="u-border-1 u-border-grey-30 u-palette-5-light-3 u-table-cell"
              >
                Description
              </td>
              <td
                class="u-border-1 u-border-grey-30 u-palette-5-light-3 u-table-cell"
              >
                Description
              </td>
              <td
                class="u-border-1 u-border-grey-30 u-palette-5-light-3 u-table-cell"
              >
                Description
              </td>
            </tr>
          </tbody>
        </table>
        <div id="page-link">
          <a href="#">1</a>
          <a href="#">2</a>
        </div>
      </div>

      <div class="toast error-toast">
        <div class="toast-content">
          <div class="message">
            <span class="text text-1">Error</span>
            <span class="text text-2"></span>
          </div>
        </div>
        <div class="progress error-progress"></div>
      </div>
      <div class="toast success-toast">
        <div class="toast-content">
          <div class="message">
            <span class="text text-1">Success</span>
            <span class="text text-2"></span>
          </div>
        </div>
        <div class="progress success-progress"></div>
    </section>
    <script>
      let currentPage;
      document.addEventListener('DOMContentLoaded', async () => {
        getTotalSignedUp();
        getTotalSessionToday();
        getAverageSession(7);
        getUsersList(1);
      });

      const usersTbody = document.getElementById('users-tbody');
      const pageLink = document.getElementById('page-link');
      async function getUsersList(page) {
        try {
          const response = await fetch(`/dashboard/users?page=${page}`);
          const responseJson = await response.json();
          if (response.ok) {
            currentPage = page;

            while (usersTbody.firstChild) {
              usersTbody.removeChild(usersTbody.firstChild);
            }
            while (pageLink.firstChild) {
              pageLink.removeChild(pageLink.firstChild);
            }

            const data = responseJson.data
            for (let i = 0; i < data.users.length; i++) {
              const user = data.users[i];

              const dataRow = document.createElement('tr');
              dataRow.style.height = '45px';

              dataRow.appendChild(createFirstCell(user.email))
              dataRow.appendChild(createCell(user.createdAt))
              dataRow.appendChild(createCell(user.loginCount))
              dataRow.appendChild(createCell(user.lastSessionAt))

              usersTbody.appendChild(dataRow);
            }

            for (let i = 1; i <= data.totalPages; i++) {
              if (i !== currentPage) {
                const link = document.createElement('a');
                link.href = "#";
                link.textContent = i;

                link.addEventListener("click", async (e) => {
                  e.preventDefault();
                  await getUsersList(i);
                });
                pageLink.appendChild(link);
              }
            }
          } else {
              showErrorToast(responseJson.error);
          }
        } catch (error) {
          console.error('An error occurred:', error);
        }
      }

      function createFirstCell(text) {
        const dataCell = document.createElement('td');
        dataCell.classList.add('u-border-1');
        dataCell.classList.add('u-border-grey-30');
        dataCell.classList.add('u-first-column');
        dataCell.classList.add('u-grey-5');
        dataCell.classList.add('u-table-cell');
        dataCell.textContent = text;
        return dataCell;
      }

      function createCell(text) {
        const dataCell = document.createElement('td');
        dataCell.classList.add('u-border-1');
        dataCell.classList.add('u-border-grey-30');
        dataCell.classList.add('u-palette-5-light-3');
        dataCell.classList.add('u-table-cell');
        dataCell.textContent = text;
        return dataCell;
      }

      const totalSignedUp = document.getElementById('total-signed-up');
      async function getTotalSignedUp() {
        try {
          const response = await fetch('/dashboard/total-signed-up');
          const responseJson = await response.json();
          if (response.ok) {
            const data = responseJson.data;
            totalSignedUp.textContent = data.total;
            // totalSignedUp.setAttribute("data-animation-name", "counter");
            // totalSignedUp.setAttribute("data-animation-event", "scroll");
            // totalSignedUp.setAttribute("data-animation-duration", "3000");
          } else {
            showErrorToast(responseJson.error);
          }
        } catch (error) {
          console.error('An error occurred:', error);
        }
      }

      const totalSessionToday = document.getElementById('total-session-today');
      async function getTotalSessionToday() {
        try {
          const response = await fetch('/dashboard/total-session-today');
          const responseJson = await response.json();
          if (response.ok) {
            const data = responseJson.data;
            totalSessionToday.textContent = data.total;
          } else {
            showErrorToast(responseJson.error);
          }
        } catch (error) {
          console.error('An error occurred:', error);
        }
      }

      const averageSession = document.getElementById('average-session');
      async function getAverageSession(day) {
        try {
          const response = await fetch(`/dashboard/average-session?day=${day}`);
          const responseJson = await response.json();
          console.log(responseJson);
          if (response.ok) {
            const data = responseJson.data;
            averageSession.textContent = data.total;
          } else {
            showErrorToast(responseJson.error);
          }
        } catch (error) {
          console.error('An error occurred:', error);
        }
      }

      const logoutBtn = document.getElementById('logout-btn');
      logoutBtn.addEventListener('click', async e => {
        try {
          const response = await fetch('/user/logout', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
          });
          const responseJson = await response.json();
          console.log(response);
          console.log(responseJson);
          if (response.ok) {
            window.location.replace('/');
          }
        } catch (error) {
          console.error('An error occurred:', error);
        }
      });

      const errorToast = document.querySelector('.error-toast');
      const errorProgress = document.querySelector('.error-progress');
      const errorToastText = document.querySelector('.error-toast .text-2');

      let timer1, timer2;
      function showErrorToast(msg) {
        errorToastText.textContent = msg;
        errorToast.classList.add('active');
        errorProgress.classList.add('active');

        timer1 = setTimeout(() => {
          errorToast.classList.remove('active');
        }, 3000);

        timer2 = setTimeout(() => {
          errorProgress.classList.remove('active');
        }, 3300);
      }

      const successToast = document.querySelector('.success-toast');
      const successProgress = document.querySelector('.success-progress');
      const successToastText = document.querySelector('.success-toast .text-2');

      function showSuccessToast(msg) {
        successToastText.textContent = msg;
        successToast.classList.add('active');
        successProgress.classList.add('active');

        timer1 = setTimeout(() => {
          successToast.classList.remove('active');
        }, 3000);

        timer2 = setTimeout(() => {
          successProgress.classList.remove('active');
        }, 3300);
      }
    </script>
  </body>
</html>
